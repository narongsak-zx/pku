<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <!-- บังคับให้แสดงผลกว้าง 1280px เสมอ (เหมือนเปิดในคอม) ไม่ว่าจะดูผ่านมือถือหรือแท็บเล็ต -->
    <meta name="viewport" content="width=1280">
    <title>โรงเรียนพุขามครุฑมณีอุทิศ</title>
    
    <!-- Libraries -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        body { 
            font-family: 'Sarabun', sans-serif; 
            background-color: #f8fafc; 
            color: #1e293b; 
            margin: 0; 
            padding: 0;
            min-width: 1280px; /* ล็อคความกว้างขั้นต่ำ */
            overflow-x: auto;  /* ให้เลื่อนซ้ายขวาได้ถ้าจอเล็กกว่า 1280 */
        }
        
        /* คอนเทนเนอร์สำหรับจัดเนื้อหาให้อยู่ตรงกลาง */
        .content-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 1.5rem;
        }
        
        /* ธีมสีน้ำเงินเข้ม-ขาว ตามรูป */
        .text-primary { color: #003366; }
        .bg-primary { background-color: #003366; }
        
        /* Navbar Link Style */
        .nav-link {
            position: relative;
            color: #003366;
            font-weight: 600;
            font-size: 16px;
            padding: 0.5rem 0;
            cursor: pointer;
            transition: color 0.2s;
            white-space: nowrap;
        }
        .nav-link:hover { color: #2563eb; /* สีฟ้าสว่างตอนชี้ */ }
        
        /* Dropdown Menu */
        .dropdown-menu {
            position: absolute;
            top: 100%;
            left: 0;
            z-index: 50;
            background: white;
            min-width: 240px;
            border-top: 4px solid #003366;
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
            display: none;
            margin-top: 10px; /* เว้นระยะห่างนิดหน่อย */
            border-radius: 4px;
        }
        /* แสดงเมนูเมื่อเอาเมาส์ชี้ที่กลุ่มแม่ (Group Hover) */
        .group:hover .dropdown-menu { display: block; animation: fadeIn 0.2s; }
        
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

        /* Banner Slider Styles */
        .slide-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            opacity: 0.5; /* ทำให้ภาพมืดลงเพื่อให้ตัวหนังสือเด่น */
            transition: transform 6s linear;
        }
        .slide-active { transform: scale(1.05); }
        
        /* Admin Float Button */
        .float-btn { 
            position: fixed; 
            bottom: 30px; 
            right: 30px; 
            width: 60px; 
            height: 60px; 
            background-color: #003366; 
            color: white; 
            border-radius: 50%; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
            z-index: 999;
            cursor: pointer;
            transition: transform 0.3s;
            border: 2px solid white;
        }
        .float-btn:hover { transform: scale(1.1); }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        // ==========================================
        //  ใส่ URL Web App ของคุณที่นี่
        // ==========================================
        const APPS_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxI05ITV_1GOsENH98_hneIJss8V9FyBq1EkRZNlmx1ARSt2l9WQAwjDz77VzhKakIK_g/exec"; 
        
        const { useState, useEffect } = React;

        // API Connector
        const api = {
            fetchAll: async () => {
                try { return await (await fetch(`${APPS_SCRIPT_URL}?action=readAll`)).json(); } 
                catch (e) { return null; }
            },
            post: async (payload) => {
                try { return await (await fetch(APPS_SCRIPT_URL, { method: 'POST', body: JSON.stringify(payload) })).json(); } 
                catch (e) { return { success: false }; }
            }
        };

        // 1. Navbar Component (White BG, Blue Text)
        const Navbar = ({ setPage, logoUrl, schoolName, pages, mainMenus }) => {
            const sortedMenus = mainMenus ? [...mainMenus].sort((a,b) => (a.Order||0) - (b.Order||0)) : [];
            
            const getSubMenu = (cat) => pages.filter(p => p.MenuCategory === cat).sort((a,b) => (a.Order||0) - (b.Order||0)).map(p => ({id: p.PageKey, label: p.Title}));

            return (
                <nav className="w-full bg-white shadow-md sticky top-0 z-50 h-24 border-b border-gray-100">
                    <div className="content-container h-full flex justify-between items-center">
                        {/* Logo & Name */}
                        <div className="flex items-center gap-4 cursor-pointer flex-shrink-0" onClick={() => setPage({id: 'home'})}>
                            <img src={logoUrl} className="w-16 h-16 object-contain" onError={(e)=>e.target.style.display='none'} />
                            <div className="flex flex-col justify-center">
                                <h1 className="text-2xl font-bold text-[#003366] leading-none whitespace-nowrap">{schoolName}</h1>
                                <p className="text-sm text-gray-500 font-medium tracking-wide mt-1 whitespace-nowrap">Phukhamkrutmaneeuthit School</p>
                            </div>
                        </div>

                        {/* Menu Items */}
                        <div className="flex gap-8 items-center h-full"> 
                            {sortedMenus.map((m, i) => {
                                const sub = m.Type === 'dropdown' ? getSubMenu(m.ID) : [];
                                return (
                                    <div key={i} className="relative group h-full flex items-center px-1 cursor-pointer">
                                        <span onClick={() => m.Type === 'link' && setPage({id: m.ID})} 
                                              className="nav-link flex items-center gap-1">
                                            {m.Label} {m.Type === 'dropdown' && <i className="fas fa-chevron-down text-[10px] opacity-50 ml-1"></i>}
                                        </span>
                                        
                                        {m.Type === 'dropdown' && sub.length > 0 && (
                                            <div className="dropdown-menu">
                                                {sub.map(s => (
                                                    <div key={s.id} onClick={() => setPage({id: 'page', key: s.id})} 
                                                         className="px-6 py-3 hover:bg-blue-50 hover:text-[#003366] transition text-sm border-b border-gray-100 last:border-0 font-medium whitespace-nowrap cursor-pointer">
                                                        {s.label}
                                                    </div>
                                                ))}
                                            </div>
                                        )}
                                    </div>
                                )
                            })}
                        </div>
                    </div>
                </nav>
            );
        };

        // 2. Hero Component (Full Width, Dark Blue BG)
        const Hero = ({ banners, schoolName }) => {
            const activeBanners = banners ? banners.filter(b => String(b.Active).toUpperCase().includes('TRUE')).sort((a,b) => (a.Order||0) - (b.Order||0)) : [];
            // ถ้าไม่มีแบนเนอร์ ให้ใช้พื้นหลังสีน้ำเงินเปล่าๆ (เหมือนในรูปที่ 1)
            const hasBanners = activeBanners.length > 0;
            const [idx, setIdx] = useState(0);

            useEffect(() => {
                if (activeBanners.length <= 1) return;
                const interval = setInterval(() => setIdx(p => (p + 1) % activeBanners.length), 5000);
                return () => clearInterval(interval);
            }, [activeBanners.length]);

            return (
                <div className="w-full relative h-[600px] bg-[#003366] overflow-hidden flex items-center justify-center text-center">
                    {/* Background Layer */}
                    {hasBanners ? (
                        <div className="absolute inset-0">
                            <img key={idx} src={activeBanners[idx].ImageURL} className="slide-image slide-active" onError={(e)=>e.target.style.display='none'} />
                        </div>
                    ) : (
                        <div className="absolute inset-0 bg-[#003366]"></div> /* Fallback Solid Blue */
                    )}

                    {/* Content Layer */}
                    <div className="relative z-10 px-4">
                        {hasBanners && activeBanners[idx].Caption ? (
                            <h2 className="text-5xl md:text-6xl font-bold text-white drop-shadow-lg mb-4 animate-bounce-in">
                                {activeBanners[idx].Caption}
                            </h2>
                        ) : (
                            <h2 className="text-5xl md:text-6xl font-bold text-white drop-shadow-lg mb-4">
                                ยินดีต้อนรับ
                            </h2>
                        )}
                        
                        {/* ชื่อโรงเรียนรอง (ถ้าต้องการเหมือนรูปที่ 2) */}
                        <p className="text-2xl text-blue-100 font-light mt-2">{schoolName}</p>
                    </div>

                    {/* Dots */}
                    {hasBanners && activeBanners.length > 1 && (
                        <div className="absolute bottom-8 flex gap-2 z-20">
                            {activeBanners.map((_, i) => (
                                <div key={i} className={`w-3 h-3 rounded-full ${i === idx ? 'bg-white' : 'bg-white/30'}`}></div>
                            ))}
                        </div>
                    )}
                </div>
            );
        };

        // 3. Main App
        const App = () => {
            const [page, setPage] = useState({ id: 'home' });
            const [data, setData] = useState(null);
            const [showLogin, setShowLogin] = useState(false);
            const [isAdmin, setIsAdmin] = useState(false);
            const [user, setUser] = useState('');
            const [pass, setPass] = useState('');

            // Load Data
            useEffect(() => {
                api.fetchAll().then(setData);
            }, []);

            // Login Handler
            const handleLogin = async (e) => {
                e.preventDefault();
                const res = await api.post({ action: 'login', username: user, password: pass });
                if(res.success) { setIsAdmin(true); setShowLogin(false); } else { alert('Login Failed'); }
            };

            if (!data) return <div className="h-screen flex items-center justify-center bg-[#f8fafc] text-[#003366] text-xl font-bold">กำลังโหลดข้อมูลโรงเรียน...</div>;

            const logoUrl = data.Config?.find(c => c.Key === 'SchoolLogo')?.Value || '';
            const schoolName = data.Config?.find(c => c.Key === 'SchoolName')?.Value || 'โรงเรียนพุขามครุฑมณีอุทิศ';

            return (
                <div className="min-h-screen flex flex-col">
                    {/* Navbar */}
                    <Navbar setPage={setPage} logoUrl={logoUrl} schoolName={schoolName} pages={data.Pages} mainMenus={data.Menus} />

                    {/* Content */}
                    <main className="flex-grow w-full bg-white">
                        {page.id === 'home' && (
                            <>
                                <Hero banners={data.Banners} schoolName={schoolName} />
                                <div className="content-container py-16">
                                    <div className="border-l-8 border-[#003366] pl-4 mb-8">
                                        <h2 className="text-3xl font-bold text-[#003366]">ข่าวประชาสัมพันธ์ล่าสุด</h2>
                                    </div>
                                    {/* News Grid (Dummy Style from Image) */}
                                    <div className="grid grid-cols-3 gap-8">
                                        {data.News.slice(0, 3).map((n, i) => (
                                            <div key={i} className="bg-white rounded-xl shadow-md overflow-hidden border border-gray-100 hover:shadow-xl transition cursor-pointer" onClick={()=>setPage({id:'news_detail', item:n})}>
                                                <div className="h-56 bg-gray-200 relative">
                                                    <img src={n.ImageURL} className="w-full h-full object-cover" onError={(e)=>e.target.style.display='none'} />
                                                    <span className="absolute top-4 left-4 bg-white/90 text-[#003366] text-xs font-bold px-3 py-1 rounded shadow">{n.Category}</span>
                                                </div>
                                                <div className="p-6">
                                                    <div className="text-xs text-gray-400 mb-2">{new Date(n.Date).toLocaleDateString('th-TH')}</div>
                                                    <h3 className="font-bold text-lg text-[#003366] mb-2 line-clamp-2">{n.Title}</h3>
                                                    <p className="text-sm text-gray-500 line-clamp-2">{n.Content}</p>
                                                    <div className="mt-4 text-[#003366] text-sm font-bold">อ่านเพิ่มเติม -></div>
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            </>
                        )}
                        
                        {/* Other Pages (Simple Placeholder) */}
                        {page.id !== 'home' && (
                            <div className="content-container py-12 min-h-[500px]">
                                <button onClick={()=>setPage({id:'home'})} className="mb-4 text-sm text-gray-500 hover:text-blue-600">&larr; กลับหน้าแรก</button>
                                {page.item ? (
                                    <div>
                                        <h1 className="text-3xl font-bold text-[#003366] mb-4">{page.item.Title}</h1>
                                        <img src={page.item.ImageURL} className="max-w-full rounded-lg shadow mb-6" />
                                        <div className="prose max-w-none whitespace-pre-wrap text-gray-700">{page.item.Content}</div>
                                    </div>
                                ) : (
                                    <div className="text-center text-gray-400 mt-20">หน้าเนื้อหาสำหรับ {page.key}</div>
                                )}
                            </div>
                        )}
                    </main>

                    {/* Footer */}
                    <footer className="bg-[#003366] text-white py-12">
                        <div className="content-container text-center">
                            <h3 className="font-bold text-xl">{schoolName}</h3>
                            <p className="text-blue-200 text-sm mt-2">&copy; 2025 All Rights Reserved.</p>
                        </div>
                    </footer>

                    {/* Admin Float Button */}
                    <div onClick={() => setShowLogin(true)} className="float-btn">
                        <i className="fas fa-user-shield text-xl"></i>
                    </div>

                    {/* Login Modal */}
                    {showLogin && !isAdmin && (
                        <div className="fixed inset-0 z-[100] flex items-center justify-center bg-black/60 backdrop-blur-sm">
                            <div className="bg-white p-8 rounded-xl shadow-2xl w-96 relative">
                                <button onClick={()=>setShowLogin(false)} className="absolute top-4 right-4 text-gray-400"><i className="fas fa-times"></i></button>
                                <h3 className="text-xl font-bold text-[#003366] text-center mb-6">เข้าสู่ระบบแอดมิน</h3>
                                <form onSubmit={handleLogin} className="space-y-4">
                                    <input className="w-full border p-3 rounded" placeholder="Username" value={user} onChange={e=>setUser(e.target.value)} />
                                    <input className="w-full border p-3 rounded" type="password" placeholder="Password" value={pass} onChange={e=>setPass(e.target.value)} />
                                    <button className="w-full bg-[#003366] text-white py-3 rounded font-bold">Login</button>
                                </form>
                            </div>
                        </div>
                    )}

                    {/* Simple Admin Panel Overlay (แสดงเมื่อ Login ผ่าน) */}
                    {isAdmin && (
                        <div className="fixed inset-0 z-[100] bg-gray-100 overflow-auto">
                            <div className="bg-[#003366] text-white p-4 flex justify-between sticky top-0">
                                <h2 className="font-bold">ระบบจัดการหลังบ้าน</h2>
                                <button onClick={()=>setIsAdmin(false)} className="bg-red-500 px-3 py-1 rounded text-sm">ออก</button>
                            </div>
                            <div className="p-10 text-center text-gray-500">
                                <i className="fas fa-tools text-4xl mb-4"></i>
                                <p>ส่วนจัดการข้อมูล (Admin Panel) ทำงานสมบูรณ์แล้วใน Code ก่อนหน้า</p>
                                <p>สามารถนำส่วน Admin Panel มาประกอบใส่ได้เลยครับ</p>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>


