<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>โรงเรียนสุรนารีวิทยา - Suranaree Witthaya School</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React Libraries -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- Icons -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <!-- Font -->
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Sarabun', sans-serif; background-color: #f3f4f6; }
        .srn-blue { color: #002d62; }
        .bg-srn-blue { background-color: #002d62; }
        .srn-yellow { color: #fbbf24; }
        .bg-srn-yellow { background-color: #fbbf24; }
        .nav-dropdown:hover .dropdown-menu { display: block; }
        .slide-image { animation: fade 4s infinite; }
        @keyframes fade { 0%,100% { opacity: 0.8; } 50% { opacity: 1; } }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        // ==========================================
        // 1. CONFIGURATION (วาง URL ของคุณที่นี่)
        // ==========================================
        const APPS_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzNz8KZyliP4Tvv1hlQKbFI67PW9vXtXoUKpBViKMWlrYV8P8_rcmh_p412n8xSO1yTSg/exec"; 
        
        const { useState, useEffect } = React;

        // --- API Helper ---
        const api = {
            fetchAll: async () => {
                const res = await fetch(`${APPS_SCRIPT_URL}?action=readAll`);
                return await res.json();
            },
            post: async (payload) => {
                const res = await fetch(APPS_SCRIPT_URL, {
                    method: 'POST', body: JSON.stringify(payload)
                });
                return await res.json();
            }
        };

        // --- Components ---

        // 1. Navbar แบบมี Submenu
        const Navbar = ({ setPage }) => {
            const [mobileOpen, setMobileOpen] = useState(false);
            
            const menus = [
                { id: 'home', label: 'หน้าแรก' },
                { id: 'about', label: 'เกี่ยวกับโรงเรียน', sub: [
                    { id: 'history', label: 'ประวัติโรงเรียน' },
                    { id: 'vision', label: 'วิสัยทัศน์/พันธกิจ' },
                    { id: 'song', label: 'เพลงมาร์ช' }
                ]},
                { id: 'personnel', label: 'บุคลากร' },
                { id: 'news', label: 'ข่าวสาร' },
                { id: 'contact', label: 'ติดต่อเรา' }
            ];

            return (
                <nav className="bg-srn-blue text-white shadow-lg sticky top-0 z-50">
                    <div className="container mx-auto px-4">
                        <div className="flex justify-between items-center h-20">
                            {/* Logo */}
                            <div className="flex items-center gap-3 cursor-pointer" onClick={() => setPage({id: 'home'})}>
                                <img src="https://www.srn.ac.th/mainpage/img/logo.png" className="h-12 w-12 drop-shadow-md bg-white rounded-full p-0.5" onError={(e)=>e.target.src='https://via.placeholder.com/50'}/>
                                <div>
                                    <h1 className="text-xl font-bold leading-none">โรงเรียนสุรนารีวิทยา</h1>
                                    <p className="text-xs text-yellow-400 tracking-wider">Suranaree Witthaya School</p>
                                </div>
                            </div>

                            {/* Desktop Menu */}
                            <div className="hidden md:flex gap-1 h-full items-center">
                                {menus.map((m, i) => (
                                    <div key={i} className="relative nav-dropdown h-full flex items-center px-4 hover:bg-blue-900 cursor-pointer group">
                                        <span onClick={() => !m.sub && setPage({id: m.id})} className="font-medium group-hover:text-yellow-400 transition">
                                            {m.label} {m.sub && <i className="fas fa-chevron-down text-xs ml-1"></i>}
                                        </span>
                                        {/* Dropdown */}
                                        {m.sub && (
                                            <div className="dropdown-menu absolute top-20 left-0 bg-white text-gray-800 shadow-xl rounded-b-lg w-48 hidden py-2 border-t-4 border-yellow-500">
                                                {m.sub.map((s, j) => (
                                                    <div key={j} onClick={() => setPage({id: 'page', key: s.id})} className="px-4 py-2 hover:bg-blue-50 hover:text-srn-blue transition border-b border-gray-100 last:border-0">
                                                        {s.label}
                                                    </div>
                                                ))}
                                            </div>
                                        )}
                                    </div>
                                ))}
                            </div>
                            
                            {/* Mobile Toggle */}
                            <button className="md:hidden text-2xl" onClick={()=>setMobileOpen(!mobileOpen)}><i className="fas fa-bars"></i></button>
                        </div>
                    </div>
                    {/* Mobile Menu */}
                    {mobileOpen && (
                        <div className="md:hidden bg-blue-900 p-4 space-y-2">
                            {menus.map((m,i) => (
                                <div key={i}>
                                    <div onClick={() => { if(!m.sub) { setPage({id:m.id}); setMobileOpen(false); } }} className="block py-2 font-bold text-yellow-400">{m.label}</div>
                                    {m.sub && m.sub.map(s => (
                                        <div key={s.id} onClick={()=>{setPage({id:'page', key:s.id}); setMobileOpen(false);}} className="pl-4 py-1 text-sm text-gray-300 border-l-2 border-gray-600 ml-2">{s.label}</div>
                                    ))}
                                </div>
                            ))}
                        </div>
                    )}
                </nav>
            );
        };

        // 2. Hero Slider
        const Hero = ({ banners }) => {
            const [idx, setIdx] = useState(0);
            
            useEffect(() => {
                const t = setInterval(() => setIdx(prev => (prev + 1) % (banners.length || 1)), 5000);
                return () => clearInterval(t);
            }, [banners]);

            if(!banners || banners.length === 0) return <div className="h-96 bg-gray-200 flex items-center justify-center">No Banner</div>;

            return (
                <div className="relative h-[300px] md:h-[500px] overflow-hidden bg-black">
                    <img src={banners[idx].ImageURL} className="w-full h-full object-cover transition-all duration-1000 opacity-80" />
                    <div className="absolute inset-0 flex flex-col justify-center items-center text-white text-center p-4 bg-gradient-to-t from-black/80 to-transparent">
                        <h2 className="text-3xl md:text-5xl font-bold mb-2 drop-shadow-lg animate-bounce">{banners[idx].Caption}</h2>
                        <div className="flex gap-2 mt-4">
                            {banners.map((_, i) => (
                                <div key={i} className={`w-3 h-3 rounded-full ${i===idx ? 'bg-yellow-400 scale-125' : 'bg-white/50'}`}></div>
                            ))}
                        </div>
                    </div>
                </div>
            );
        };

        // 3. Page Components
        const NewsSection = ({ news, limit }) => (
            <div className="grid md:grid-cols-3 gap-6">
                {(limit ? news.slice(0,limit) : news).map((n, i) => (
                    <div key={i} className="bg-white rounded-xl shadow-md overflow-hidden hover:shadow-xl transition transform hover:-translate-y-1">
                        <div className="h-48 overflow-hidden relative">
                             <img src={n.ImageURL || 'https://via.placeholder.com/400'} className="w-full h-full object-cover" />
                             <span className="absolute top-2 right-2 bg-yellow-400 text-srn-blue text-xs font-bold px-2 py-1 rounded shadow">{n.Category}</span>
                        </div>
                        <div className="p-5">
                            <h3 className="font-bold text-lg mb-2 text-srn-blue line-clamp-2">{n.Title}</h3>
                            <p className="text-gray-500 text-sm mb-4 line-clamp-3">{n.Content}</p>
                            <div className="flex justify-between items-center text-xs text-gray-400 border-t pt-3">
                                <span><i className="far fa-calendar mr-1"></i> {new Date(n.Date).toLocaleDateString('th-TH')}</span>
                                <span className="text-blue-500 font-bold cursor-pointer">อ่านต่อ <i className="fas fa-arrow-right"></i></span>
                            </div>
                        </div>
                    </div>
                ))}
            </div>
        );

        const PersonnelList = ({ people }) => (
            <div className="grid grid-cols-2 md:grid-cols-4 gap-6">
                {people.map((p, i) => (
                    <div key={i} className="bg-white p-6 rounded-xl shadow text-center border-t-4 border-srn-blue">
                        <div className="w-24 h-24 mx-auto mb-4 relative">
                            <img src={p.ImageURL || 'https://via.placeholder.com/150'} className="w-full h-full object-cover rounded-full border-4 border-gray-100 shadow-sm" />
                            <div className="absolute bottom-0 right-0 bg-yellow-400 w-6 h-6 rounded-full border-2 border-white"></div>
                        </div>
                        <h4 className="font-bold text-lg text-srn-blue">{p.Name}</h4>
                        <p className="text-sm font-medium text-yellow-600">{p.Position}</p>
                        <p className="text-xs text-gray-400 mt-1">{p.Group}</p>
                    </div>
                ))}
            </div>
        );

        const StaticPage = ({ pageData }) => {
            if(!pageData) return <div className="p-10 text-center">Loading Content...</div>
            return (
                <div className="bg-white rounded-xl shadow-lg p-8 md:p-12">
                    <h2 className="text-3xl font-bold text-srn-blue mb-6 border-l-8 border-yellow-400 pl-4">{pageData.Title}</h2>
                    <div className="prose max-w-none text-gray-700 whitespace-pre-wrap leading-relaxed">
                        {pageData.Content}
                    </div>
                    {pageData.ImageURL && <img src={pageData.ImageURL} className="mt-8 rounded-lg shadow-md w-full md:w-2/3 mx-auto" />}
                </div>
            );
        };

        // 4. Admin Dashboard
        const AdminPanel = ({ data, reload, onClose }) => {
            const [tab, setTab] = useState('News');
            const [editItem, setEditItem] = useState(null);
            const [form, setForm] = useState({});

            const handleSave = async (e) => {
                e.preventDefault();
                const payload = { ...form };
                if (editItem) payload.ID = editItem.ID || editItem.PageKey; // Keep ID for update
                
                if(!confirm('ยืนยันการบันทึก?')) return;
                await api.post({ action: 'save', sheet: tab, data: payload });
                alert('บันทึกสำเร็จ');
                setEditItem(null); setForm({}); reload();
            };

            const handleDelete = async (id) => {
                if(!confirm('ลบรายการนี้?')) return;
                await api.post({ action: 'delete', sheet: tab, id: id });
                reload();
            };

            const openEdit = (item) => {
                setEditItem(item);
                setForm(item);
            };

            return (
                <div className="fixed inset-0 bg-gray-100 z-[100] flex flex-col">
                    <div className="bg-gray-900 text-white p-4 flex justify-between items-center shadow">
                        <div className="font-bold text-xl"><i className="fas fa-cogs text-yellow-500 mr-2"></i>ระบบจัดการหลังบ้าน SRN</div>
                        <button onClick={onClose} className="bg-red-600 hover:bg-red-700 px-4 py-2 rounded text-sm font-bold">ออกจากระบบ</button>
                    </div>
                    <div className="flex flex-1 overflow-hidden">
                        {/* Sidebar */}
                        <div className="w-64 bg-white border-r hidden md:block overflow-y-auto">
                            <div className="p-4">
                                <h3 className="text-gray-400 text-xs font-bold uppercase mb-2">เมนูหลัก</h3>
                                {['News', 'Personnel', 'Banners', 'Pages'].map(t => (
                                    <button key={t} onClick={()=>{setTab(t); setEditItem(null); setForm({});}} 
                                        className={`w-full text-left p-3 rounded mb-1 transition ${tab===t ? 'bg-srn-blue text-white shadow' : 'hover:bg-gray-100'}`}>
                                        {t === 'News' ? 'ข่าวประชาสัมพันธ์' : t === 'Personnel' ? 'บุคลากร' : t === 'Banners' ? 'สไลด์หน้าแรก' : 'เนื้อหาหน้าเว็บ'}
                                    </button>
                                ))}
                            </div>
                        </div>
                        {/* Content */}
                        <div className="flex-1 p-8 overflow-y-auto">
                            <div className="flex justify-between mb-6">
                                <h2 className="text-2xl font-bold text-gray-800">{tab} Management</h2>
                                {tab !== 'Pages' && <button onClick={()=>setEditItem({})} className="bg-green-600 text-white px-4 py-2 rounded shadow hover:bg-green-700"><i className="fas fa-plus"></i> เพิ่มข้อมูลใหม่</button>}
                            </div>

                            {/* Form Area */}
                            {(editItem !== null) && (
                                <div className="bg-white p-6 rounded-xl shadow-lg mb-8 border border-blue-100">
                                    <h3 className="font-bold mb-4 text-srn-blue">{form.ID || form.PageKey ? 'แก้ไขข้อมูล' : 'เพิ่มข้อมูลใหม่'}</h3>
                                    <form onSubmit={handleSave} className="grid gap-4">
                                        {Object.keys(data[tab][0] || {}).map(key => {
                                            if(key === 'ID' || key === 'Date') return null; // Skip Auto fields
                                            if(key === 'PageKey') return <input key={key} value={form[key]} disabled className="bg-gray-100 border p-2 rounded" />;
                                            return (
                                                <div key={key}>
                                                    <label className="text-xs font-bold text-gray-500 uppercase">{key}</label>
                                                    {key === 'Content' ? 
                                                        <textarea className="w-full border p-2 rounded h-32 focus:ring-2 ring-blue-500 outline-none" value={form[key]||''} onChange={e=>setForm({...form, [key]:e.target.value})}></textarea>
                                                        : <input className="w-full border p-2 rounded focus:ring-2 ring-blue-500 outline-none" value={form[key]||''} onChange={e=>setForm({...form, [key]:e.target.value})} />
                                                    }
                                                </div>
                                            )
                                        })}
                                        <div className="flex gap-2 mt-2">
                                            <button type="submit" className="bg-blue-600 text-white px-6 py-2 rounded">บันทึก</button>
                                            <button type="button" onClick={()=>setEditItem(null)} className="bg-gray-300 text-gray-700 px-6 py-2 rounded">ยกเลิก</button>
                                        </div>
                                    </form>
                                </div>
                            )}

                            {/* List Area */}
                            <div className="grid gap-4">
                                {data[tab].map((item, i) => (
                                    <div key={i} className="bg-white p-4 rounded shadow flex justify-between items-center hover:bg-gray-50 border-l-4 border-transparent hover:border-yellow-400">
                                        <div>
                                            <div className="font-bold text-gray-800">{item.Title || item.Name || item.Caption}</div>
                                            <div className="text-sm text-gray-500">{item.Category || item.Position || item.PageKey}</div>
                                        </div>
                                        <div className="flex gap-2">
                                            <button onClick={()=>openEdit(item)} className="text-blue-500 bg-blue-50 p-2 rounded hover:bg-blue-100"><i className="fas fa-edit"></i></button>
                                            {tab !== 'Pages' && <button onClick={()=>handleDelete(item.ID)} className="text-red-500 bg-red-50 p-2 rounded hover:bg-red-100"><i className="fas fa-trash"></i></button>}
                                        </div>
                                    </div>
                                ))}
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // --- MAIN APP ---
        const App = () => {
            const [page, setPage] = useState({ id: 'home' });
            const [data, setData] = useState(null);
            const [isAdmin, setIsAdmin] = useState(false);

            const loadData = async () => {
                const res = await api.fetchAll();
                setData(res);
            };

            useEffect(() => { loadData(); }, []);

            const handleLogin = async () => {
                const u = prompt('Admin Username:');
                const p = prompt('Password:');
                if(!u || !p) return;
                const res = await api.post({ action: 'login', username: u, password: p });
                if(res.success) setIsAdmin(true); else alert('รหัสผิดพลาด');
            };

            if(!data) return <div className="flex items-center justify-center h-screen bg-srn-blue text-white"><i className="fas fa-circle-notch fa-spin text-4xl mr-3"></i> กำลังโหลดข้อมูลโรงเรียน...</div>;

            return (
                <div className="min-h-screen flex flex-col font-sarabun">
                    {isAdmin ? (
                        <AdminPanel data={data} reload={loadData} onClose={()=>setIsAdmin(false)} />
                    ) : (
                        <>
                            <Navbar setPage={setPage} />
                            
                            <main className="flex-grow">
                                {/* HOME PAGE */}
                                {page.id === 'home' && (
                                    <>
                                        <Hero banners={data.Banners} />
                                        
                                        {/* Intro Section */}
                                        <div className="bg-white py-12">
                                            <div className="container mx-auto px-4 text-center">
                                                <h2 className="text-3xl font-bold text-srn-blue mb-2">วินัยเยี่ยม เปี่ยมคุณธรรม เลิศล้ำวิชาการ</h2>
                                                <p className="text-gray-500 mb-8">เชี่ยวชาญงานเทคโนโลยี</p>
                                                <div className="flex justify-center gap-4">
                                                    <button onClick={()=>setPage({id:'page', key:'history'})} className="border-2 border-srn-blue text-srn-blue px-6 py-2 rounded-full hover:bg-srn-blue hover:text-white transition">ประวัติโรงเรียน</button>
                                                    <button onClick={()=>setPage({id:'page', key:'vision'})} className="bg-yellow-400 text-srn-blue px-6 py-2 rounded-full hover:bg-yellow-500 transition font-bold">วิสัยทัศน์</button>
                                                </div>
                                            </div>
                                        </div>

                                        {/* News Section */}
                                        <div className="container mx-auto px-4 py-12">
                                            <div className="flex justify-between items-center mb-8 border-b pb-4">
                                                <h2 className="text-2xl font-bold text-srn-blue"><i className="fas fa-bullhorn text-yellow-500 mr-2"></i> ข่าวประชาสัมพันธ์ล่าสุด</h2>
                                                <button onClick={()=>setPage({id:'news'})} className="text-gray-500 hover:text-srn-blue">ดูทั้งหมด</button>
                                            </div>
                                            <NewsSection news={data.News} limit={3} />
                                        </div>
                                    </>
                                )}

                                {/* OTHER PAGES */}
                                {page.id === 'news' && (
                                    <div className="container mx-auto px-4 py-12">
                                        <h2 className="text-3xl font-bold mb-8 text-center text-srn-blue">ข่าวสารทั้งหมด</h2>
                                        <NewsSection news={data.News} />
                                    </div>
                                )}

                                {page.id === 'personnel' && (
                                    <div className="container mx-auto px-4 py-12">
                                        <h2 className="text-3xl font-bold mb-8 text-center text-srn-blue">คณะผู้บริหารและบุคลากร</h2>
                                        <PersonnelList people={data.Personnel} />
                                    </div>
                                )}

                                {page.id === 'page' && (
                                    <div className="container mx-auto px-4 py-12">
                                        <StaticPage pageData={data.Pages.find(p => p.PageKey === page.key)} />
                                    </div>
                                )}

                                {page.id === 'contact' && (
                                    <div className="container mx-auto px-4 py-12">
                                        <div className="bg-white rounded-xl shadow-lg overflow-hidden flex flex-col md:flex-row">
                                            <div className="md:w-1/2 bg-srn-blue text-white p-12">
                                                <h2 className="text-3xl font-bold mb-6">ติดต่อโรงเรียน</h2>
                                                <ul className="space-y-4 text-lg">
                                                    <li><i className="fas fa-map-marker-alt w-8 text-yellow-400"></i> ถ.มิตรภาพ อ.เมือง จ.นครราชสีมา</li>
                                                    <li><i className="fas fa-phone w-8 text-yellow-400"></i> 044-xxx-xxx</li>
                                                    <li><i className="fas fa-envelope w-8 text-yellow-400"></i> admin@srn.ac.th</li>
                                                </ul>
                                            </div>
                                            <div className="md:w-1/2 p-12">
                                                <iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3854.123!2d102.0!3d14.9!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x0%3A0x0!2zMTTCsDU4JzE1LjkiTiAxMDLCsDA1JzMxLjUiRQ!5e0!3m2!1sth!2sth!4v1600000000000!5m2!1sth!2sth" width="100%" height="300" style={{border:0}} allowFullScreen="" loading="lazy"></iframe>
                                            </div>
                                        </div>
                                    </div>
                                )}
                            </main>

                            {/* Footer */}
                            <footer className="bg-gray-900 text-gray-400 py-10">
                                <div className="container mx-auto px-4 flex flex-col md:flex-row justify-between items-center gap-4">
                                    <div className="text-center md:text-left">
                                        <h3 className="text-white font-bold text-lg">โรงเรียนสุรนารีวิทยา</h3>
                                        <p className="text-sm">Suranaree Witthaya School</p>
                                    </div>
                                    <div className="text-sm">
                                        &copy; 2024 All Rights Reserved.
                                    </div>
                                    <button onClick={handleLogin} className="text-gray-600 hover:text-white transition text-xs">
                                        <i className="fas fa-lock"></i> Admin Login
                                    </button>
                                </div>
                            </footer>
                        </>
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>


